<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<title>äººç”Ÿè½‰å½è™•ï½œå¤©è³¦æ•¸å­—äº’å‹•é«”é©—</title>
<style>
/* å®Œå…¨é‚„åŸæ‚¨å–œæ„›çš„å¤§åœ“è§’ç™½è‰²åœ–å¡ç¾å­¸ */
body { margin: 0; font-family: "Helvetica Neue", sans-serif; background: #47b2ca; /* èª¿å›æ‚¨åœ–ä¸­çš„èƒŒæ™¯è— */ transition: background 0.8s; display: flex; justify-content: center; align-items: flex-start; min-height: 100vh; padding: 20px 0; }
#app { width: 90%; max-width: 390px; background: #fff; border-radius: 35px; padding: 20px; box-shadow: 0 20px 50px rgba(0,0,0,.15); }

h3 { margin-top: 0; font-size: 20px; color: #333; }
p { line-height: 1.6; color: #444; }
button { width: 100%; padding: 14px; margin: 8px 0; border-radius: 16px; border: none; font-size: 16px; cursor: pointer; background: #f0f0f0; transition: 0.3s; }
button:hover { background: #e3edff; }

/* çµæœå‘ˆç¾å€å¡Š - å¸¶èƒŒæ™¯è‰²çš„åœ“è§’å¡ç‰‡ */
.result-card { border-radius: 22px; padding: 22px; color: #fff; box-shadow: 0 8px 25px rgba(0,0,0,.1); margin-bottom: 15px; }
.result-card ul { padding-left: 20px; margin: 12px 0; }
.result-card li { margin-bottom: 5px; font-weight: 500; }

/* åº•éƒ¨è¯çµ¡å€å¡Š - æš–é»ƒè‰²èƒŒæ™¯ */
.contact-section { background: #fee38b; border-radius: 22px; padding: 20px; text-align: center; color: #5a3e00; margin-top: 15px; }
.contact-section a { color: #5a3e00; font-weight: bold; text-decoration: underline; display: block; margin: 10px 0; word-break: break-all; }
.qr { width: 130px; margin: 10px auto; border-radius: 10px; display: block; }

.number-section { text-align: center; margin: 15px 0; }
.number-card-img { width: 100%; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); }
.fade { animation: fadeIn 1s ease-in-out; }
@keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
</style>
</head>
<body>

<div id="app"></div>

<script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
<script>
const app = document.getElementById("app");
const body = document.body;

let state = {
    userName: "æœªçŸ¥ä¾†è³“",
    userPic: "",
    userStatusMessage: "æ¢ç´¢ä¸­...",
    deviceInfo: navigator.userAgent,
    mode: "", mood: "", coping: "", desire: "", number: null
};

/* ====== LIFF åˆå§‹åŒ– ====== */
async function main() {
    try {
        await liff.init({ liffId: "2008876179-yvn4oUyo" }); 
        if (liff.isLoggedIn()) {
            await fetchProfile();
        } else if (liff.isInClient()) {
            liff.login();
        }
    } catch (err) { console.error("Init Error", err); }
}

async function fetchProfile() {
    try {
        const profile = await liff.getProfile();
        state.userName = profile.displayName;
        state.userPic = profile.pictureUrl || "";
        state.userStatusMessage = profile.statusMessage || "é€™ä½æœ‹å‹å¾ˆä½èª¿ ğŸŒ¿";
    } catch (e) { console.error("Profile Error", e); }
}
main();

/* ====== é¡è‰²èˆ‡æ•¸æ“š ====== */
const numberColors = { 1: "#e94e77", 2: "#f39c12", 3: "#f1c40f", 4: "#27ae60", 5: "#16a085", 6: "#3498db", 7: "#8e44ad", 8: "#2c3e50", 9: "#9b59b6" };
const numerology = { 1: { traits: ["ä¸»å‹•", "é ˜å°", "è¡Œå‹•åŠ›"], tone: "è«‹ç›¸ä¿¡ä½ ä¸æ˜¯è¡å‹•ï¼Œè€Œæ˜¯èµ°åœ¨å‰é¢ã€‚â˜€ï¸" }, 2: { traits: ["æ•æ„Ÿ", "å”èª¿", "å‚¾è½"], tone: "ä½ çš„æº«æŸ”ï¼Œæ˜¯ä¸–ç•Œéœ€è¦çš„åŠ›é‡ã€‚ğŸŒŠ" }, 3: { traits: ["è¡¨é”", "å‰µæ„", "å¹½é»˜"], tone: "è¢«çœ‹è¦‹çš„ï¼Œæ˜¯ä½ çœŸå¯¦çš„æ¨£å­ã€‚ğŸŒˆ" }, 4: { traits: ["ç©©å®š", "è¸å¯¦", "çµæ§‹"], tone: "æ…¢ä¸€é»ï¼Œä½ åè€Œèµ°å¾—æœ€é ã€‚ğŸŒ²" }, 5: { traits: ["è‡ªç”±", "è®ŠåŒ–", "å½ˆæ€§"], tone: "æ”¹è®Šä¸æ˜¯é€ƒé›¢ï¼Œè€Œæ˜¯æˆé•·ã€‚ğŸ•Šï¸" }, 6: { traits: ["ç…§é¡§", "æ‰¿æ“”", "é—œä¿‚"], tone: "è«‹è¨˜å¾—ï¼Œä½ ä¹Ÿå€¼å¾—è¢«ç…§é¡§ã€‚ğŸ•¯ï¸" }, 7: { traits: ["æ€è€ƒ", "æ´å¯Ÿ", "å…§çœ"], tone: "å®‰éœï¼Œæ˜¯ä½ æ•´ç†ä¸–ç•Œçš„æ–¹å¼ã€‚ğŸ§˜" }, 8: { traits: ["åŠ›é‡", "å¯¦è¸", "å½±éŸ¿"], tone: "ä½ æœ‰èƒ½åŠ›æ‰¿è¼‰æ›´å¤§çš„å±€ã€‚ğŸ”ï¸" }, 9: { traits: ["åŒ…å®¹", "å®Œæˆ", "æ™ºæ…§"], tone: "æš«åœï¼Œæ˜¯ç‚ºäº†æ–°çš„é–‹å§‹ã€‚ğŸ" } };

function dynamicMessage(s, n) {
    const m1 = { å·¥ä½œ: "åœ¨å·¥ä½œèˆ‡è²¬ä»»ä¹‹ä¸­ï¼ŒğŸ’¼", å®¶åº­: "åœ¨å®¶åº­èˆ‡é—œä¿‚è£¡ï¼ŒğŸ ", æ±ºç­–: "é¢å°é‡è¦é¸æ“‡æ™‚ï¼ŒğŸ§­", è‡ªæˆ‘: "å›åˆ°ä½ è‡ªå·±èº«ä¸Šï¼ŒğŸŒ±" };
    const m2 = { éœ§: "ä½ å…¶å¯¦å·²ç¶“æ„Ÿè¦ºåˆ°è¿·æƒ˜ï¼ŒğŸŒ«ï¸", å…‰: "ä½ å·²ç¶“çœ‹è¦‹ä¸€æ¢å¯èƒ½çš„è·¯ï¼ŒğŸŒ…", å¤œ: "ä½ æ­£åœ¨ä½èª¿ç´¯ç©åŠ›é‡ï¼ŒğŸŒŒ", é¢¨: "ä½ æ¸´æœ›æ”¹è®Šç¾ç‹€ï¼ŒğŸŒ¬ï¸" };
    const m3 = { æ’è‘—ä¸èªª: "ä½†ä½ é¸æ“‡å…ˆæ’ä½ä¸èªªï¼ŒğŸ’ª", éœä¸‹æ²‰æ¾±: "ä½ è®“è‡ªå·±æ…¢æ…¢æ²‰æ¾±ï¼ŒğŸ§˜", æ‰¾äººèŠèŠ: "ä½ é¡˜æ„å°‹æ±‚é€£çµï¼ŒğŸ’¬", è½‰ç§»æ³¨æ„: "ä½ æš«æ™‚ä¸æƒ³æ­£é¢é¢å°ï¼ŒğŸ§" };
    const m4 = { ç©©å®š: "å› ç‚ºä½ éœ€è¦å®‰å…¨æ„Ÿã€‚ğŸ”¥", çªç ´: "å› ç‚ºä½ ä¸æƒ³å†åŸåœ°æ‰“è½‰ã€‚ğŸš€", å¹³è¡¡: "å› ç‚ºä½ æƒ³æ‰¾å›å…§åœ¨ç§©åºã€‚âš–ï¸", æ”¾ä¸‹: "å› ç‚ºä½ çœŸçš„èƒŒå¤ªå¤šäº†ã€‚ğŸƒ" };
    return `${m1[s.mode]}${m2[s.mood]}${m3[s.coping]}${m4[s.desire]} \n\n${numerology[n].tone}`;
}

function lifeNumber(dob) {
    let sum = dob.replaceAll("-", "").split("").reduce((a, b) => a + Number(b), 0);
    while (sum > 9) sum = sum.toString().split("").reduce((a, b) => a + Number(b), 0);
    return sum;
}

/* ====== æ­¥é©Ÿé‚è¼¯ ====== */
function start() {
    app.innerHTML = `<h3 class="fade">å¦‚æœèµ°åˆ°äººç”Ÿä¸€å€‹è½‰å½è™•...âœ¨</h3><p>ç¾åœ¨æœ€æƒ³é—œæ³¨å“ªå€‹é¢å‘ï¼Ÿ</p>
    <button onclick="step1('å·¥ä½œ')">ğŸ§³ å·¥ä½œ / äº‹æ¥­</button><button onclick="step1('å®¶åº­')">ğŸ  å®¶åº­ / é—œä¿‚</button>
    <button onclick="step1('æ±ºç­–')">ğŸ§­ é‡å¤§æ±ºç­–</button><button onclick="step1('è‡ªæˆ‘')">ğŸŒ± è‡ªæˆ‘ç‹€æ…‹</button>`;
}
start();

function step1(v) { state.mode = v; app.innerHTML = `<h3 class="fade">æ­¤åˆ»çš„å…§åœ¨é¢¨æ™¯åƒå“ªä¸€å¹…ï¼ŸğŸ–¼ï¸</h3>
<button onclick="step2('éœ§')">ğŸŒ«ï¸ è¿·éœ§</button><button onclick="step2('å…‰')">ğŸŒ… æ›™å…‰</button>
<button onclick="step2('å¤œ')">ğŸŒŒ æ˜Ÿå¤œ</button><button onclick="step2('é¢¨')">ğŸŒ¬ï¸ å¾®é¢¨</button>`; }

function step2(v) { state.mood = v; app.innerHTML = `<h3 class="fade">é¢å°é€™æ¨£çš„ç‹€æ…‹...â˜•</h3>
<button onclick="step3('æ’è‘—ä¸èªª')">ğŸ’ªğŸ˜‘ æ’è‘—ä¸èªª</button><button onclick="step3('éœä¸‹æ²‰æ¾±')">ğŸ§˜â€â™€ï¸ğŸ§˜ğŸ¼ éœä¸‹æ²‰æ¾±</button>
<button onclick="step3('æ‰¾äººèŠèŠ')">ğŸ’¬ğŸ‘¥ æ‰¾äººèŠèŠ</button><button onclick="step3('è½‰ç§»æ³¨æ„')">ğŸ§ğŸ¤¹ è½‰ç§»æ³¨æ„</button>`; }

function step3(v) { state.coping = v; app.innerHTML = `<h3 class="fade">å¿ƒåº•æ·±è™•ï¼Œä½ æ›´æ¸´æœ›å“ªä¸€ç¨®ï¼ŸğŸƒ</h3>
<button onclick="step4('ç©©å®š')">ğŸ”¥ ç©©å®š</button><button onclick="step4('çªç ´')">ğŸš€ çªç ´</button>
<button onclick="step4('å¹³è¡¡')">âš–ï¸ å¹³è¡¡</button><button onclick="step4('æ”¾ä¸‹')">ğŸƒ æ”¾ä¸‹</button>`; }

function step4(v) { state.desire = v; app.innerHTML = `<h3 class="fade">æœ€å¾Œï¼Œè«‹è¼¸å…¥æ‚¨çš„ç”Ÿæ—¥ ğŸ“…</h3><p>è®“æˆ‘å€‘ä»¥æ­¤é–‹å•Ÿæ•¸å­—çš„å°è©±...</p>
<input id="dob" type="date" style="width:100%;padding:12px;border-radius:12px;border:1px solid #ddd;box-sizing:border-box;margin-bottom:15px;">
<button onclick="showResult()">ğŸ”® æƒ³çœ‹çœ‹å¦‚ä½•å‰é€² ğŸ§­</button>`; }

async function showResult() {
    const dob = document.getElementById("dob").value;
    if (!dob) { alert("è«‹è¼¸å…¥æ—¥æœŸ"); return; }
    
    // ç¢ºä¿æŠ“åˆ°åå­—
    if (liff.isLoggedIn() && state.userName === "æœªçŸ¥ä¾†è³“") { await fetchProfile(); }

    state.number = lifeNumber(dob);
    const n = state.number;
    const traits = numerology[n].traits.join("ã€"); 
    const blessing = dynamicMessage(state, n); 

    app.innerHTML = `
    <div class="result-card fade" style="background:${numberColors[n]}">
        <h3>æ‚¨çš„å°ˆå±¬å¤©è³¦æ•¸å­—æ˜¯ ${n}</h3>
        <ul>${numerology[n].traits.map(t => `<li>âœ¨ ${t}</li>`).join("")}</ul>
        <p>${blessing.replace(/\n/g, '<br>')}</p>
    </div>
    
    <div class="number-section fade">
        <img src="N0${n}C.png" class="number-card-img" alt="å¤©è³¦æ•¸å­—åœ–å¡">
    </div>
    
    <div class="contact-section fade">
        <p>æœŸå¾…æœ‰æ©ŸæœƒèŠèŠï¼Œ<br>é»æ“Šé€£çµæˆ–æƒæ QRCode<br>å³å¯èˆ‡ Betterï¼ˆé‡ç¾©ï¼‰è¯çµ¡ï¼š</p>
        <a href="https://better885.pse.is/Line2BetterHung" target="_blank">https://better885.pse.is/Line2BetterHung</a>
        <img src="BetterQRCode.jpg" class="qr">
        <p>å¦‚æœæœ‰è¢«å°å° Touch åˆ°ï¼Œ<br>æ­¡è¿åˆ†äº«çµ¦ğŸ‘«æœ€å¥½çš„æœ‹å‹ğŸ’Œ</p>
        <p>ä¹ŸæœŸå¾…æ‚¨èˆ‡æˆ‘åˆ†äº«æ‚¨çš„åœ–å¡ğŸ´</p>
        <small style="opacity:0.5;">2026/01/15 Ver 2.6.7 (ç¾å­¸é‚„åŸç‰ˆ)</small>
    </div>`;

    sendToBackstage(dob, n, traits, blessing);
}

async function sendToBackstage(dob, n, traits, blessing) {
    const gasUrl = "https://script.google.com/macros/s/AKfycbw9IbWl6aCYYzF8x4T6ttW5NlKpvPQEvFmE8DgRhf7ya43r9PJSwmSZk7KwMrVySGL9/exec";
    const fullReport = `ğŸŒŸ ã€å¤©è³¦æ•¸å­—æ¢ç´¢å ±å‘Šã€‘ ğŸŒŸ\nğŸ‘¤ å§“åï¼š${state.userName}\nğŸ”® ç‹€æ…‹ï¼š${state.userStatusMessage}\nğŸ”¢ æ•¸å­—ï¼š${n} è™Ÿäºº\nğŸ“… ç”Ÿæ—¥ï¼š${dob}\nâœ‰ï¸ ç¥ç¦ï¼š${blessing}`.trim();
    fetch(gasUrl, { method: "POST", body: JSON.stringify({ result: fullReport }), mode: 'no-cors' });
}
</script>
</body>
</html>